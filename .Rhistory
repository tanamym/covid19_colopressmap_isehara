Fixed_Date2=paste0("2022-",str_replace(Fixed_Date2,"月","-")))
}else{
while(TRUE){
kanagawa_today<-try(read.csv(paste0("https://www.pref.kanagawa.jp",CSV[1,1]))%>%
rename("Residential_City"="居住地",
"Fixed_Date2"="陽性判明日",
"Sex"="性別",
"Age"="年代",
"note"="発生届を受理した保健福祉事務所")%>%
filter(!is.na(患者概要))%>%
filter(Residential_City!="")%>%
select(Residential_City,Fixed_Date2,Sex,Age,note)%>%
mutate(Fixed_Date=Sys.Date(),
PR_Date=Sys.Date(),
Hos="神奈川県",
hos="kanagawa")%>%
mutate(Fixed_Date2=str_remove(Fixed_Date2,"日"),
Fixed_Date2=paste0("2022-",str_replace(Fixed_Date2,"月","-"))))
if(class(kanagawa_today) != "try-error")break
}
}
}
}else{
kanagawa_today<-data.frame()
}
if(Sys.Date()=="2021-11-10"){
kanagawa_today<-kanagawa_today%>%
mutate(Fixed_Date2=str_replace(Fixed_Date2,"202.年",""))
}
kanagawa<-read.csv("kanagawa2.csv") %>%
select(-X)%>%
mutate(PR_Date=as.Date(PR_Date))%>%
mutate(Fixed_Date=as.Date(Fixed_Date),
Fixed_Date2=as.Date(Fixed_Date2))%>%
mutate(Hos="神奈川県")%>%
mutate(hos="kanagawa")%>%
rbind(kanagawa_today)
kanagawa2<-rbind(kanagawa,yokohama,sagamihara,fujisawa,yokosuka) %>%
mutate(Hospital_Pref ="神奈川県",
Residential_Pref="神奈川県"
)
xy<-read.csv("xy.csv") %>%
select(-X.1)%>%
rename("Residential_City"="居住市区町村")
chigasaki<-
read.csv("chigasaki.csv")%>%
mutate(Hospital_Pref ="神奈川県",
Residential_Pref="神奈川県"
)%>%
mutate(PR_Date=as.Date(PR_Date))%>%
mutate(Fixed_Date=as.Date(Fixed_Date),
Fixed_Date2=as.Date(Fixed_Date2))%>%
left_join(xy,by="Residential_City")%>%
mutate(Hos="茅ヶ崎市",
hos="chigasaki")%>%
mutate(note=NA)%>%
arrange(desc(Fixed_Date))
list1<-read.csv("list.csv")
data3<-
data%>%
left_join(list1,by=c("Residential_City"="list"))%>%
select(-Residential_City)%>%
rename("Residential_City"="管内")
kanagawa2<-
left_join(kanagawa2,xy,by="Residential_City") %>%
mutate(Fixed_Date=as.Date(Fixed_Date))
kawasaki<-
read.csv("kawasaki.csv") %>%
select(-X)%>%
mutate(Fixed_Date=as.Date(Fixed_Date),
PR_Date=as.Date(PR_Date),
Fixed_Date2=as.Date(Fixed_Date2))%>%
left_join(list1)%>%
select(-管内,-Residential_City)%>%
rename("Residential_City"="list")%>%
mutate(Hos="川崎市",
hos="kawasaki")%>%
arrange(desc(Fixed_Date))
yokohama0220<-read.csv("yokohama20220220.csv")%>%
mutate(Fixed_Date=as.Date(Fixed_Date),
PR_Date=as.Date(PR_Date),
Hos="横浜",hos="yokohama")%>%
mutate(note=str_remove(note,"区"))
data<-bind_rows(data2,data3,kanagawa2,kawasaki,chigasaki,yokohama0220)%>%
select(Fixed_Date,Hospital_Pref,Residential_City,Age,
Sex,X,Y,PR_Date,Fixed_Date2,Hos,note,hos)%>%
filter(Fixed_Date<Sys.Date())%>%
mutate(Age=str_remove(Age,"代"),
Age=ifelse(str_detect(Age,"100"),"100-",Age),
Age=ifelse(str_detect(Age,"歳"),"0-10",Age),
Age=str_replace(Age,"－","-"),
Age=str_remove_all(Age," "))%>%
arrange(desc(Fixed_Date),Hospital_Pref,Hos,Residential_City)
# data2021<-
#   data%>%
#   filter(Fixed_Date>as.Date("2021-09-30"))
# data20220215<-
#   data%>%
#   filter(Fixed_Date>=as.Date("2022-02-01"))%>%
#   filter(Fixed_Date<=as.Date("2022-02-15"))
data2022<-
data%>%
filter(Fixed_Date>=as.Date("2022-02-16"))
if(format(Sys.time(),"%H")%in%c("17","18","19","20","21")){
data<-bind_rows(data2,data3,kanagawa2,kawasaki,chigasaki,yokohama0220)%>%
select(Fixed_Date,Hospital_Pref,Residential_City,Age,
Sex,X,Y,PR_Date,Fixed_Date2,Hos,note,hos)%>%
mutate(Age=str_remove(Age,"代"),
Age=ifelse(str_detect(Age,"歳"),"0-10",Age),
Age=str_replace(Age,"－","-"),
Age=str_remove_all(Age," "))%>%
arrange(desc(Fixed_Date),Hospital_Pref,Hos,Residential_City)
# data2021<-
#   data%>%
#   filter(Fixed_Date>as.Date("2021-09-30"))
data2022<-
data%>%
filter(Fixed_Date>=as.Date("2022-02-16"))
# data202201<-
#   data%>%
#   filter(Fixed_Date>as.Date("2021-09-30"))%>%
#   filter(Fixed_Date<=as.Date("2022-01-31"))
}
#write.csv(data20220215,"data20220215.csv",row.names=F,fileEncoding="UTF-8")
write.csv(data2022,"data2022.csv",row.names=F,fileEncoding="UTF-8")
#write.csv(data202201,"data202201.csv",row.names=F,fileEncoding="UTF-8")
#write.csv(data2021,"data2021.csv",row.names=F,fileEncoding="UTF-8")
#write.csv(data%>%filter(Fixed_Date>as.Date("2021-06-30"),Fixed_Date<=as.Date("2021-09-30")),"data202109.csv",row.names=F,fileEncoding="UTF-8")
print("coviddata.csvを出力しました")
data<-bind_rows(data2,data3,kanagawa2,kawasaki,chigasaki,yokohama0220)%>%
select(Fixed_Date,Hospital_Pref,Residential_City,Age,
Sex,X,Y,PR_Date,Fixed_Date2,Hos,note,hos)%>%
mutate(Age=str_remove(Age,"代"),
Age=ifelse(str_detect(Age,"歳"),"0-10",Age),
Age=str_replace(Age,"－","-"),
Age=str_remove_all(Age," "))%>%
arrange(desc(Fixed_Date),Hospital_Pref,Hos,Residential_City)
# data2021<-
#   data%>%
#   filter(Fixed_Date>as.Date("2021-09-30"))
data2022<-
data%>%
filter(Fixed_Date>=as.Date("2022-02-16"))
# data202201<-
#   data%>%
#   filter(Fixed_Date>as.Date("2021-09-30"))%>%
#   filter(Fixed_Date<=as.Date("2022-01-31"))
}
#write.csv(data20220215,"data20220215.csv",row.names=F,fileEncoding="UTF-8")
write.csv(data2022,"data2022.csv",row.names=F,fileEncoding="UTF-8")
source("C:/data/covid/readfilename4.R", encoding = 'UTF-8', echo=TRUE)
View(yokohama)
yokohama%>%
filter(PR_Date==Sys.Date())
nrow(yokohama%>%
filter(PR_Date==Sys.Date()))
read.csv("https://www.city.yokohama.lg.jp/kurashi/kenko-iryo/yobosesshu/kansensho/coronavirus/corona-data.files/141003_yokohama_covid19_patients.csv")
read.csv("https://www.city.yokohama.lg.jp/kurashi/kenko-iryo/yobosesshu/kansensho/coronavirus/corona-data.files/141003_yokohama_covid19_patients.csv")
fread("https://www.city.yokohama.lg.jp/kurashi/kenko-iryo/yobosesshu/kansensho/coronavirus/corona-data.files/141003_yokohama_covid19_patients.csv")
fread("https://www.city.yokohama.lg.jp/kurashi/kenko-iryo/yobosesshu/kansensho/coronavirus/corona-data.files/141003_yokohama_covid19_patients.csv",, encoding="UTF-8")
fread("https://www.city.yokohama.lg.jp/kurashi/kenko-iryo/yobosesshu/kansensho/coronavirus/corona-data.files/141003_yokohama_covid19_patients.csv",
encoding="UTF-8")%>%
filter(記者発表日==Sys.Date())
fread("https://www.city.yokohama.lg.jp/kurashi/kenko-iryo/yobosesshu/kansensho/coronavirus/corona-data.files/141003_yokohama_covid19_patients.csv",
encoding="UTF-8")%>%
data.frame()%>%
filter(記者発表日==Sys.Date())
nrow(yo)!=0
yo<-fread("https://www.city.yokohama.lg.jp/kurashi/kenko-iryo/yobosesshu/kansensho/coronavirus/corona-data.files/141003_yokohama_covid19_patients.csv",
encoding="UTF-8")%>%
data.frame()%>%
filter(記者発表日==Sys.Date())
nrow(yo)!=0
paste0("yokohama",Sys.Date(),".csv")
View(yokohama0220)
row.names(yokohama0220)
col.names(yokohama0220)
colnames(yokohama0220)
colnames(yo)
yo<-yo%>%
rename("Residential_City"="市町村名",
"Fixed_Date"="記者発表日",
"Age"="年代",
"Sex"="性別",
"note"="住所地",
"Residential_Pref"="都道府県名",
)%>%
mutate(PR_Date=Fixed_Date,
Hos="横浜",
hos="yokohama",
X="",
Y="",
Hospital_Pref="",
Fixed_Date2="")
View(yo)
yo<-fread("https://www.city.yokohama.lg.jp/kurashi/kenko-iryo/yobosesshu/kansensho/coronavirus/corona-data.files/141003_yokohama_covid19_patients.csv",
encoding="UTF-8")%>%
data.frame()%>%
filter(記者発表日==Sys.Date())
yo<-yo%>%
rename("Residential_City"="市町村名",
"Fixed_Date"="記者発表日",
"Age"="年代",
"Sex"="性別",
"note"="住所地",
"Residential_Pref"="都道府県名",
)%>%
mutate(PR_Date=Fixed_Date,
Hos="横浜",
hos="yokohama",
X="",
Y="",
Hospital_Pref="",
Fixed_Date2="")%>%
select(Residential_Pref,Residential_City,Fixed_Date,Age,Sex,note,
PR_Date,Fixed_Date2,Hos,hos,Hospital_Pref,X,Y)
View(yo)
yo<-fread("https://www.city.yokohama.lg.jp/kurashi/kenko-iryo/yobosesshu/kansensho/coronavirus/corona-data.files/141003_yokohama_covid19_patients.csv",
encoding="UTF-8")%>%
data.frame()%>%
filter(記者発表日==Sys.Date())
yo<-yo%>%
rename("Residential_City"="市町村名",
"Fixed_Date"="記者発表日",
"Age"="年代",
"Sex"="性別",
"note"="住所地",
"Residential_Pref"="都道府県名",
)%>%
mutate(PR_Date=Fixed_Date,
Hos="横浜",
hos="yokohama",
X="",
Y="",
Hospital_Pref="",
Fixed_Date2="")%>%
select(Residential_Pref,Residential_City,Fixed_Date,Age,Sex,note,
PR_Date,Fixed_Date2,Hos,hos,Hospital_Pref,X,Y)
write.csv(yo,paste0("yokohama",Sys.Date(),".csv"),row.names = F)
write.csv(yo,paste0("yoko/yokohama",Sys.Date(),".csv"),row.names = F)
yo_list<-list.files("C:\data\covid\yoko")
yo_list<-list.files("C:/data/covid/yoko")
do.call(rbind,lapply(yo_list,read.csv))
source("C:/data/covid/readfilename4.R", encoding = 'UTF-8', echo=TRUE)
data<-bind_rows(data2,data3,kanagawa2,kawasaki,chigasaki,yokohama0220,yo2)%>%
select(Fixed_Date,Hospital_Pref,Residential_City,Age,
Sex,X,Y,PR_Date,Fixed_Date2,Hos,note,hos)%>%
filter(Fixed_Date<Sys.Date())%>%
mutate(Age=str_remove(Age,"代"),
Age=ifelse(str_detect(Age,"100"),"100-",Age),
Age=ifelse(str_detect(Age,"歳"),"0-10",Age),
Age=str_replace(Age,"－","-"),
Age=str_remove_all(Age," "))%>%
arrange(desc(Fixed_Date),Hospital_Pref,Hos,Residential_City)
yo2<-do.call(rbind,lapply(yo_list,read.csv))%>%
mutate(Fixed_Date2=as.Date(Fixed_Date2))
data<-bind_rows(data2,data3,kanagawa2,kawasaki,chigasaki,yokohama0220,yo2)%>%
select(Fixed_Date,Hospital_Pref,Residential_City,Age,
Sex,X,Y,PR_Date,Fixed_Date2,Hos,note,hos)%>%
filter(Fixed_Date<Sys.Date())%>%
mutate(Age=str_remove(Age,"代"),
Age=ifelse(str_detect(Age,"100"),"100-",Age),
Age=ifelse(str_detect(Age,"歳"),"0-10",Age),
Age=str_replace(Age,"－","-"),
Age=str_remove_all(Age," "))%>%
arrange(desc(Fixed_Date),Hospital_Pref,Hos,Residential_City)
yo2<-do.call(rbind,lapply(yo_list,read.csv))%>%
mutate(Fixed_Date2=as.Date(Fixed_Date2),
Hospital_Pref=as.character(Hospital_Pref))
data<-bind_rows(data2,data3,kanagawa2,kawasaki,chigasaki,yokohama0220,yo2)%>%
select(Fixed_Date,Hospital_Pref,Residential_City,Age,
Sex,X,Y,PR_Date,Fixed_Date2,Hos,note,hos)%>%
filter(Fixed_Date<Sys.Date())%>%
mutate(Age=str_remove(Age,"代"),
Age=ifelse(str_detect(Age,"100"),"100-",Age),
Age=ifelse(str_detect(Age,"歳"),"0-10",Age),
Age=str_replace(Age,"－","-"),
Age=str_remove_all(Age," "))%>%
arrange(desc(Fixed_Date),Hospital_Pref,Hos,Residential_City)
yo2<-do.call(rbind,lapply(yo_list,read.csv))%>%
mutate(Fixed_Date2=as.Date(Fixed_Date2),
Hospital_Pref=as.character(Hospital_Pref),
Residential_Pref=as.character(Residential_Pref))
data<-bind_rows(data2,data3,kanagawa2,kawasaki,chigasaki,yokohama0220,yo2)%>%
select(Fixed_Date,Hospital_Pref,Residential_City,Age,
Sex,X,Y,PR_Date,Fixed_Date2,Hos,note,hos)%>%
filter(Fixed_Date<Sys.Date())%>%
mutate(Age=str_remove(Age,"代"),
Age=ifelse(str_detect(Age,"100"),"100-",Age),
Age=ifelse(str_detect(Age,"歳"),"0-10",Age),
Age=str_replace(Age,"－","-"),
Age=str_remove_all(Age," "))%>%
arrange(desc(Fixed_Date),Hospital_Pref,Hos,Residential_City)
yo2<-do.call(rbind,lapply(yo_list,read.csv))%>%
mutate(Fixed_Date2=as.Date(Fixed_Date2),
Hospital_Pref=as.character(Hospital_Pref),
Residential_Pref=as.character(Residential_Pref),
Residential_City=as.character(Residential_City))
data<-bind_rows(data2,data3,kanagawa2,kawasaki,chigasaki,yokohama0220,yo2)%>%
select(Fixed_Date,Hospital_Pref,Residential_City,Age,
Sex,X,Y,PR_Date,Fixed_Date2,Hos,note,hos)%>%
filter(Fixed_Date<Sys.Date())%>%
mutate(Age=str_remove(Age,"代"),
Age=ifelse(str_detect(Age,"100"),"100-",Age),
Age=ifelse(str_detect(Age,"歳"),"0-10",Age),
Age=str_replace(Age,"－","-"),
Age=str_remove_all(Age," "))%>%
arrange(desc(Fixed_Date),Hospital_Pref,Hos,Residential_City)
yo2<-do.call(rbind,lapply(yo_list,read.csv))%>%
mutate(Fixed_Date2=as.Date(Fixed_Date2),
Hospital_Pref=as.character(Hospital_Pref),
Residential_Pref=as.character(Residential_Pref),
Residential_City=as.character(Residential_City),
Age=as.character(Age),
Sex=as.character(Sex))
data<-bind_rows(data2,data3,kanagawa2,kawasaki,chigasaki,yokohama0220,yo2)%>%
select(Fixed_Date,Hospital_Pref,Residential_City,Age,
Sex,X,Y,PR_Date,Fixed_Date2,Hos,note,hos)%>%
filter(Fixed_Date<Sys.Date())%>%
mutate(Age=str_remove(Age,"代"),
Age=ifelse(str_detect(Age,"100"),"100-",Age),
Age=ifelse(str_detect(Age,"歳"),"0-10",Age),
Age=str_replace(Age,"－","-"),
Age=str_remove_all(Age," "))%>%
arrange(desc(Fixed_Date),Hospital_Pref,Hos,Residential_City)
yo2<-do.call(rbind,lapply(yo_list,read.csv))%>%
mutate(Fixed_Date2=as.Date(Fixed_Date2),
Hospital_Pref=as.character(Hospital_Pref),
Residential_Pref=as.character(Residential_Pref),
Residential_City=as.character(Residential_City),
Age=as.character(Age),
Sex=as.character(Sex),
PR_Date=as.character(PR_Date))
data<-bind_rows(data2,data3,kanagawa2,kawasaki,chigasaki,yokohama0220,yo2)%>%
select(Fixed_Date,Hospital_Pref,Residential_City,Age,
Sex,X,Y,PR_Date,Fixed_Date2,Hos,note,hos)%>%
filter(Fixed_Date<Sys.Date())%>%
mutate(Age=str_remove(Age,"代"),
Age=ifelse(str_detect(Age,"100"),"100-",Age),
Age=ifelse(str_detect(Age,"歳"),"0-10",Age),
Age=str_replace(Age,"－","-"),
Age=str_remove_all(Age," "))%>%
arrange(desc(Fixed_Date),Hospital_Pref,Hos,Residential_City)
yo2<-do.call(rbind,lapply(yo_list,read.csv))%>%
mutate(Fixed_Date2=as.Date(Fixed_Date2),
Hospital_Pref=as.character(Hospital_Pref),
Residential_Pref=as.character(Residential_Pref),
Residential_City=as.character(Residential_City),
Age=as.character(Age),
Sex=as.character(Sex),
PR_Date=as.Date(PR_Date))
data<-bind_rows(data2,data3,kanagawa2,kawasaki,chigasaki,yokohama0220,yo2)%>%
select(Fixed_Date,Hospital_Pref,Residential_City,Age,
Sex,X,Y,PR_Date,Fixed_Date2,Hos,note,hos)%>%
filter(Fixed_Date<Sys.Date())%>%
mutate(Age=str_remove(Age,"代"),
Age=ifelse(str_detect(Age,"100"),"100-",Age),
Age=ifelse(str_detect(Age,"歳"),"0-10",Age),
Age=str_replace(Age,"－","-"),
Age=str_remove_all(Age," "))%>%
arrange(desc(Fixed_Date),Hospital_Pref,Hos,Residential_City)
yo2<-do.call(rbind,lapply(yo_list,read.csv))%>%
mutate(Fixed_Date2=as.Date(Fixed_Date2),
Hospital_Pref=as.character(Hospital_Pref),
Residential_Pref=as.character(Residential_Pref),
Residential_City=as.character(Residential_City),
Age=as.character(Age),
Sex=as.character(Sex),
PR_Date=as.Date(PR_Date),
Fixed_Date=as.Date(Fixed_Date))
data<-bind_rows(data2,data3,kanagawa2,kawasaki,chigasaki,yokohama0220,yo2)%>%
select(Fixed_Date,Hospital_Pref,Residential_City,Age,
Sex,X,Y,PR_Date,Fixed_Date2,Hos,note,hos)%>%
filter(Fixed_Date<Sys.Date())%>%
mutate(Age=str_remove(Age,"代"),
Age=ifelse(str_detect(Age,"100"),"100-",Age),
Age=ifelse(str_detect(Age,"歳"),"0-10",Age),
Age=str_replace(Age,"－","-"),
Age=str_remove_all(Age," "))%>%
arrange(desc(Fixed_Date),Hospital_Pref,Hos,Residential_City)
yo2<-do.call(rbind,lapply(yo_list,read.csv))%>%
mutate(Fixed_Date2=as.Date(Fixed_Date2),
Hospital_Pref=as.character(Hospital_Pref),
Residential_Pref=as.character(Residential_Pref),
Residential_City=as.character(Residential_City),
Age=as.character(Age),
Sex=as.character(Sex),
PR_Date=as.Date(PR_Date),
Fixed_Date=as.Date(Fixed_Date),
Hos=as.character(Hos),
hos=as.character(hos))
data<-bind_rows(data2,data3,kanagawa2,kawasaki,chigasaki,yokohama0220,yo2)%>%
select(Fixed_Date,Hospital_Pref,Residential_City,Age,
Sex,X,Y,PR_Date,Fixed_Date2,Hos,note,hos)%>%
filter(Fixed_Date<Sys.Date())%>%
mutate(Age=str_remove(Age,"代"),
Age=ifelse(str_detect(Age,"100"),"100-",Age),
Age=ifelse(str_detect(Age,"歳"),"0-10",Age),
Age=str_replace(Age,"－","-"),
Age=str_remove_all(Age," "))%>%
arrange(desc(Fixed_Date),Hospital_Pref,Hos,Residential_City)
yo2<-do.call(rbind,lapply(yo_list,read.csv))%>%
mutate(Fixed_Date2=as.Date(Fixed_Date2),
Hospital_Pref=as.character(Hospital_Pref),
Residential_Pref=as.character(Residential_Pref),
Residential_City=as.character(Residential_City),
Age=as.character(Age),
Sex=as.character(Sex),
PR_Date=as.Date(PR_Date),
Fixed_Date=as.Date(Fixed_Date),
Hos=as.character(Hos),
hos=as.character(hos),
note=as.character(note))
data<-bind_rows(data2,data3,kanagawa2,kawasaki,chigasaki,yokohama0220,yo2)%>%
select(Fixed_Date,Hospital_Pref,Residential_City,Age,
Sex,X,Y,PR_Date,Fixed_Date2,Hos,note,hos)%>%
filter(Fixed_Date<Sys.Date())%>%
mutate(Age=str_remove(Age,"代"),
Age=ifelse(str_detect(Age,"100"),"100-",Age),
Age=ifelse(str_detect(Age,"歳"),"0-10",Age),
Age=str_replace(Age,"－","-"),
Age=str_remove_all(Age," "))%>%
arrange(desc(Fixed_Date),Hospital_Pref,Hos,Residential_City)
source("C:/data/covid/readfilename4.R", encoding = 'UTF-8', echo=TRUE)
nrow(yokohama%>%
filter(PR_Date==Sys.Date()))
nrow(yokohama%>%
filter(PR_Date==Sys.Date()))
nrow(yokohama%>%
filter(PR_Date==Sys.Date()))==0
yo<-fread("https://www.city.yokohama.lg.jp/kurashi/kenko-iryo/yobosesshu/kansensho/coronavirus/corona-data.files/141003_yokohama_covid19_patients.csv",
encoding="UTF-8")%>%
data.frame()%>%
filter(記者発表日==Sys.Date())
yo<-fread("https://www.city.yokohama.lg.jp/kurashi/kenko-iryo/yobosesshu/kansensho/coronavirus/corona-data.files/141003_yokohama_covid19_patients.csv",
encoding="UTF-8")%>%
data.frame()%>%
filter(記者発表日==Sys.Date())
fread("https://www.city.yokohama.lg.jp/kurashi/kenko-iryo/yobosesshu/kansensho/coronavirus/corona-data.files/141003_yokohama_covid19_patients.csv",
encoding="UTF-8")
fread("https://www.city.yokohama.lg.jp/kurashi/kenko-iryo/yobosesshu/kansensho/coronavirus/corona-data.files/141003_yokohama_covid19_patients.csv",
encoding="UTF-8")
fread("https://www.city.yokohama.lg.jp/kurashi/kenko-iryo/yobosesshu/kansensho/coronavirus/corona-data.files/141003_yokohama_covid19_patients.csv",
encoding="UTF-8")
fread("https://www.city.yokohama.lg.jp/kurashi/kenko-iryo/yobosesshu/kansensho/coronavirus/corona-data.files/141003_yokohama_covid19_patients.csv",
encoding="UTF-8")
fread("https://www.city.yokohama.lg.jp/kurashi/kenko-iryo/yobosesshu/kansensho/coronavirus/corona-data.files/141003_yokohama_covid19_patients.csv",
encoding="UTF-8")
fread("https://www.city.yokohama.lg.jp/kurashi/kenko-iryo/yobosesshu/kansensho/coronavirus/corona-data.files/141003_yokohama_covid19_patients.csv",
encoding="UTF-8")
fread("https://www.city.yokohama.lg.jp/kurashi/kenko-iryo/yobosesshu/kansensho/coronavirus/corona-data.files/141003_yokohama_covid19_patients.csv",
encoding="UTF-8")
fread("https://www.city.yokohama.lg.jp/kurashi/kenko-iryo/yobosesshu/kansensho/coronavirus/corona-data.files/141003_yokohama_covid19_patients.csv",
encoding="UTF-8")
fread("https://www.city.yokohama.lg.jp/kurashi/kenko-iryo/yobosesshu/kansensho/coronavirus/corona-data.files/141003_yokohama_covid19_patients.csv",
encoding="UTF-8")
fread("https://www.city.yokohama.lg.jp/kurashi/kenko-iryo/yobosesshu/kansensho/coronavirus/corona-data.files/141003_yokohama_covid19_patients.csv",
encoding="UTF-8")
if(nrow(yokohama%>%
filter(PR_Date==Sys.Date()))==0){
while (TRUE) {
yo<-try(fread("https://www.city.yokohama.lg.jp/kurashi/kenko-iryo/yobosesshu/kansensho/coronavirus/corona-data.files/141003_yokohama_covid19_patients.csv",
encoding="UTF-8")%>%
data.frame()%>%
filter(記者発表日==Sys.Date()))
if(class(yo) != "try-error")break
}
if(nrow(yo)!=0){
yo<-yo%>%
rename("Residential_City"="市町村名",
"Fixed_Date"="記者発表日",
"Age"="年代",
"Sex"="性別",
"note"="住所地",
"Residential_Pref"="都道府県名",
)%>%
mutate(PR_Date=Fixed_Date,
Hos="横浜",
hos="yokohama",
X="",
Y="",
Hospital_Pref="",
Fixed_Date2="")%>%
select(Residential_Pref,Residential_City,Fixed_Date,Age,Sex,note,
PR_Date,Fixed_Date2,Hos,hos,Hospital_Pref,X,Y)%>%
mutate(note=str_remove(note,"区"))
write.csv(yo,paste0("yoko/yokohama",Sys.Date(),".csv"),row.names = F)
}
}
ead.csv("https://www.pref.kanagawa.jp/osirase/1369/data/csv/patient.csv") %>%
filter(!str_detect(居住地,"管内")) %>%
rename("PR_Date"="発表日","Residential_City"="居住地",
"Sex"="性別",
"Age"="年代") %>%
#select(-年代,-性別)%>%
mutate(Residential_City = str_replace(Residential_City,"神奈川県",""))%>%
mutate(PR_Date=as.Date(PR_Date))%>%
mutate(Fixed_Date2=NA,
Fixed_Date=PR_Date)%>%
mutate(Hos=NA)
read.csv("https://www.pref.kanagawa.jp/osirase/1369/data/csv/patient.csv") %>%
filter(!str_detect(居住地,"管内")) %>%
rename("PR_Date"="発表日","Residential_City"="居住地",
"Sex"="性別",
"Age"="年代") %>%
#select(-年代,-性別)%>%
mutate(Residential_City = str_replace(Residential_City,"神奈川県",""))%>%
mutate(PR_Date=as.Date(PR_Date))%>%
mutate(Fixed_Date2=NA,
Fixed_Date=PR_Date)%>%
mutate(Hos=NA)
source("C:/data/covid/readfilename4.R", encoding = 'UTF-8', echo=TRUE)
